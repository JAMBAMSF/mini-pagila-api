<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mini Pagila API — One‑Page Rubric Mapping</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif; margin: 40px; }
    .page { max-width: 820px; margin: 0 auto; }
    h1 { font-size: 22px; margin-bottom: 6px; }
    h2 { font-size: 16px; margin-top: 18px; margin-bottom: 6px; }
    ul { margin-top: 6px; margin-bottom: 6px; }
    code { background: #f6f8fa; padding: 1px 4px; border-radius: 3px; }
    small { color: #555; }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Mini Pagila API rubric mapping one‑pager" />
  <meta name="author" content="Submission v1.0" />
  <meta name="color-scheme" content="light dark" />
  <style>@media print { a[href]:after { content: ""; } }</style>
  
</head>
<body>
  <div class="page">
    <h1>Mini Pagila API — One‑Page Rubric Mapping</h1>
    <p><small>Repo: https://github.com/JAMBAMSF/mini-pagila-api &nbsp; • &nbsp; Release: v1.0</small></p>

    <h2>Endpoints & Acceptance Criteria</h2>
    <ul>
      <li><strong>Films Listing</strong> — GET <code>/v1/films</code> (200 OK, pagination + category)
        — <code>pagila_api/api/v1/film_routes.py:1</code>
      </li>
      <li><strong>Create Rental</strong> — POST <code>/v1/customers/{id}/rentals</code> (201 Created, Bearer auth)
        — <code>pagila_api/api/v1/rental_routes.py:1</code>, auth <code>pagila_api/core/auth.py:1</code>
      </li>
      <li><strong>AI Ask</strong> — GET <code>/v1/ai/ask</code> (SSE)
        — <code>pagila_api/api/v1/ai_routes.py:67</code></li>
      <li><strong>AI Summary</strong> — POST <code>/v1/ai/summary</code> (strict JSON)
        — <code>pagila_api/api/v1/ai_routes.py:91</code>, prompts under <code>pagila_api/core/prompts/summary/</code></li>
      <li><strong>AI Handoff</strong> — POST <code>/v1/ai/handoff</code> (SearchAgent → LLMAgent)
        — <code>pagila_api/api/v1/ai_routes.py:114</code>, agents <code>pagila_api/app/agents/</code></li>
    </ul>

    <h2>Platform & Data</h2>
    <ul>
      <li>App: <code>pagila_api/app/main.py:1</code> (lifespan, routers)</li>
      <li>DB/Models: <code>pagila_api/domain/models.py:1</code> • Alembic: <code>pagila_api/migrations/env.py:1</code></li>
      <li>SQL dataset: <code>pagila_sql/pagila-schema.sql</code>, <code>pagila_sql/pagila-data.sql</code></li>
      <li>Config/Logging: <code>pagila_api/core/config.py:1</code>, <code>pagila_api/core/logging.py:1</code></li>
      <li>Semantic Kernel + OpenAI: <code>pagila_api/core/ai_kernel.py:1</code>, <code>pagila_api/domain/services.py:169</code></li>
    </ul>

    <h2>Tests</h2>
    <ul>
      <li>Suite: <code>pagila_api/tests/test_ai.py:1</code>, fixtures <code>pagila_api/tests/conftest.py:1</code></li>
      <li>Coverage: AI streaming, summary shape, handoff, rentals</li>
      <li>Run: <code>cd pagila_api && poetry run pytest -q</code> (6 passed)</li>
    </ul>

    <h2>Runbook (Quickstart)</h2>
    <ul>
      <li>Python 3.11 + Poetry</li>
      <li>Create DB: <code>createdb pagila</code>; Load SQL: <code>psql -d pagila -f pagila_sql/pagila-schema.sql</code> and <code>pagila_sql/pagila-data.sql</code></li>
      <li>Env: <code>cp pagila_api/.env.example pagila_api/.env</code> and set <code>OPENAI_API_KEY</code></li>
      <li>Migrate: <code>cd pagila_api && poetry run alembic upgrade head</code></li>
      <li>Run: <code>poetry run uvicorn app.main:app --reload</code> → http://127.0.0.1:8000/docs</li>
    </ul>

    <h2>Notes</h2>
    <ul>
      <li>No secrets committed; use <code>.env.example</code>. AI routes require an OpenAI key.</li>
    </ul>
  </div>
</body>
</html>
